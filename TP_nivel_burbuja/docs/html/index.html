<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nivel de Superficies Digital: Nivel de Superficies Digital</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Nivel de Superficies Digital
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Nivel de Superficies Digital </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_jez_Documents_micros_STM32_TP_nivel_burbuja_README"></a> Este proyecto fue creado con el objetivo de funcionar como TP final para las materias "Protocolos de Comunicación en Sistemas Embebidos" y "Programación de Microcontroladores" de la <b>Carrera de Especialización en Sistemas Embebidos</b> de la UBA.</p>
<p>El proyecto consiste en un <b>Nivel de Superficies Digital</b> que simula el funcionamiento del clásico <em>nivel de burbuja</em> utilizado en carpintería, pero implementado digitalmente. Utiliza un acelerómetro MPU-6500 para medir la inclinación de una superficie en los ejes X e Y, representando el desplazamiento de la burbuja en una matriz de LEDs 8x8. Se modeló la aplicación como una máquina de estado finito cuyos estados se corresponden a los modos de funcionamiento: <em>medición simple del nivel de una superficie</em> o <em>comparador de superficies</em>. Este segundo modo permite almacenar una medición y compararla con otra en simultáneo.</p>
<p>El sistema está basado en una placa STM32 NUCLEO-F446RE, y emplea los siguientes protocolos de comunicación para comunicarse con los módulos de entradas y salidas: I²C para el acelerómetro, SPI para la matriz de LEDs y UART para mostrar los valores de entrada y salida por el monitor serial.</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Estructura del Proyecto</h1>
<p>La aplicación del nivel de superficies se encuentra desarrollada en el archivo <code><a class="el" href="main_8c.html" title=": Main program body">main.c</a></code>. La documentación del proyecto fue generada con <em>Doxygen</em>, el archivo <code>Doxyfile</code> y la documentación generada en <code>html/</code> se encuentran ubicados en la carpeta <code>docs/</code> ubicada a nivel de proyecto.</p>
<p>Esta aplicación utiliza varios drivers específicos desarrollados para facilitar el uso de retardos no bloqueantes, el debounce del botón utilizado para cambiar de modo y el envío de datos mediante la UART. Estos drivers específicos fueron desarrollados como parte de las prácticas de la materia <em>Programación de MIcrocontroladores</em> y mejorados o adaptados para este proyecto, se encuentran ubicados en la carpeta <code>API/</code>.</p>
<p>Para la configuración y comunicación con los módulos externos seleccionados para el proyecto (el acelerómetro y el display de LEDs) se desarrollaron los <em>Device Drivers</em> correspondoentes que se encuentran ubicados respectivamente en las carpetas <code>ledMatrix_MAX7219/</code> y <code>GY521_MPU6500/</code>, acompañados de su respectiva documentación.</p>
<div class="fragment"><div class="line">TP_nivel_burbuja/                                                </div>
<div class="line">├── README.md                          # README del proyecto (a nivel aplicación) </div>
<div class="line">├── docs/                              </div>
<div class="line">|    ├── Doxyfile                      # Doxyfile del proyecto</div>
<div class="line">|    └── html/                         # Documentación del proyecto (en HTML) generada con Doxygen</div>
<div class="line">├── Core/                              </div>
<div class="line">|    ├── Inc/                            </div>
<div class="line">|    |    ├── main.h                             </div>
<div class="line">|    |    └── …                          </div>
<div class="line">|    ├── Src/                            </div>
<div class="line">|    |    ├── main.c                   # Archivo principal de la aplicación         </div>
<div class="line">|    |    └── …                        </div>
<div class="line">└── Drivers/                            </div>
<div class="line">     ├── API/                          # Drivers Específicos</div>
<div class="line">     |    ├── README.md                # README de los drivers específicos         </div>
<div class="line">     |    ├── Inc/                     </div>
<div class="line">     |    |    ├── API_delay.h         # Proporciona funciones para retardos no bloqueantes                 </div>
<div class="line">     |    |    ├── API_debounce.h      # Implementa una máquina de estados para el debounce de botón                   </div>
<div class="line">     |    |    └── API_uart.h          # Interfaz para la configuración y uso de UART2               </div>
<div class="line">     |    └── Src/                        </div>
<div class="line">     |         ├── API_delay.c         # Implementación de las funciones de retardo no bloqueante                 </div>
<div class="line">     |         ├── API_debounce.c      # Implementación de la máquina de estados de debounce                   </div>
<div class="line">     |         └── API_uart.c          # Implementación de las funciones de UART2    </div>
<div class="line">     |                  </div>
<div class="line">     ├── ledMatrix_MAX7219/            # Device Driver para Matrix de LEDs de 8x8 con controlador MAX7219           </div>
<div class="line">     |    ├── README.md                # README del driver       </div>
<div class="line">     |    ├── docs/                    # Documentación sobre el driver</div>
<div class="line">     |    ├── Inc/                       </div>
<div class="line">     |    |    ├── ledMatrix.h         # Interfaz de alto nivel del driver                           </div>
<div class="line">     |    |    └── ledMatrix_port.h    # Interfaz de bajo nivel (acceso al hardware)                     </div>
<div class="line">     |    └── Src/                          </div>
<div class="line">     |         ├── ledMatrix.c         # Implementación de funciones de alto nivel                </div>
<div class="line">     |         └── ledMatrix_port.c    # Implementación de funciones específicas del hardware y comunicación por SPI   </div>
<div class="line">     |                 </div>
<div class="line">     └── GY521_MPU6500/                # Device Driver para el acelerómetro del GY-521 con controlador MPU-6500         </div>
<div class="line">          ├── README.md                # README del driver       </div>
<div class="line">          ├── docs/                    # Documentación sobre el driver     </div>
<div class="line">          ├── Inc/                       </div>
<div class="line">          |    ├── GY521.h             # Interfaz de alto nivel del driver                       </div>
<div class="line">          |    └── GY521_port.h        # Interfaz de bajo nivel (acceso al hardware)                 </div>
<div class="line">          └── Src/                          </div>
<div class="line">               ├── GY521.c             # Implementación de funciones de alto nivel               </div>
<div class="line">               └── GY521_port.c        # Implementación de funciones específicas del hardware y comunicación por I²C                 </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md25"></a>
Características</h1>
<ul>
<li>Matriz de LEDs 8x8: Se utiliza para mostrar la posición de la burbuja en un espacio bidimensional.</li>
<li>Acelerómetro GY-521 (MPU-6050): Para detectar la inclinación de la superficie.</li>
<li>Modos de operación:<ul>
<li>Medición Simple: Muestra la posición dinámica de la burbuja.</li>
<li>Comparación de Niveles: Permite guardar la posición de la burbuja y compararla con una posición dinámica nueva.</li>
</ul>
</li>
<li>Interfaz UART: Los datos sobre el estado de la burbuja y las lecturas del acelerómetro se envían a través de UART para su visualización o procesamiento externo.</li>
</ul>
<h1><a class="anchor" id="autotoc_md26"></a>
Funcionamiento</h1>
<h2><a class="anchor" id="autotoc_md27"></a>
Inicialización</h2>
<ol type="1">
<li>Al encender el sistema, se realiza una secuencia de inicialización que configura la matriz de LEDs, el acelerómetro y los periféricos necesarios.</li>
<li>Se muestra una imagen de bienvenida en la matriz de LEDs.</li>
</ol>
<h2><a class="anchor" id="autotoc_md28"></a>
Modo de Medición Simple</h2>
<p>En este modo, el sistema lee constantemente los valores de aceleración del GY-521 y mapea estos valores a las coordenadas de la matriz de LEDs. El "dot" se mueve de acuerdo a la inclinación de la superficie, representando la burbuja en tiempo real.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Modo de Comparación de Niveles</h2>
<p>Este modo permite al usuario fijar una posición de la burbuja. Luego, puede comparar esta posición con las mediciones actuales, mostrando si la burbuja se encuentra en una posición más alta, más baja o en la misma.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Comunicación UART</h2>
<p>El sistema envía datos a través de UART, incluyendo:</p><ul>
<li>El estado de la burbuja.</li>
<li>Las lecturas del acelerómetro.</li>
<li>Las posiciones de la burbuja (movil y fija).</li>
</ul>
<h1><a class="anchor" id="autotoc_md31"></a>
Funciones Principales</h1>
<ul>
<li><b><a class="el" href="main_8c.html#ab770accc0a3c32281d41a7d3951103f6" title="Inicializa la FSM del nivel de burbuja.">bubbleInit()</a></b>: Inicializa el sistema y los periféricos.</li>
<li><b><a class="el" href="main_8c.html#a1c6e3311d3a8710ce72a2d7eaa9ee743" title="Actualiza la FSM del nivel de burbuja.">bubbleUpdate()</a></b>: Actualiza el estado de la burbuja, incluyendo la lectura del acelerómetro y el procesamiento del botón.</li>
<li><b><a class="el" href="main_8c.html#a88fa672843b988a199b78049c65d2e3e" title="Genera el buffer de pantalla a partir de la posición (o posiciones) especificada.">drawMatrix()</a></b>: Dibuja la representación de la burbuja en la matriz de LEDs.</li>
<li><b><a class="el" href="main_8c.html#ae2d33623859408b0923249f4a261caf0" title="Realiza el mapping entre los valores obtenidos del acelerómetro y la posición de la burbuja.">mapAccelToPosition()</a></b>: Mapea los valores del acelerómetro a las coordenadas de la matriz.</li>
<li><b><a class="el" href="main_8c.html#aeb2f5c0dd95e9909dd6942d7fc22f14e" title="Envía los valores de entrada y salida por la UART.">sendOutputsByUart()</a></b>: Envía los datos actuales por UART. </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
